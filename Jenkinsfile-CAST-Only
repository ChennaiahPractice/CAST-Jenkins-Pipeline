node ('master') {
    stage ('CAST-Get Code') {
        dir('CAST-Scripts') {
           git branch: 'master', credentialsId: 'Github-prabinovich', url: 'https://github.com/prabinovich/CAST-Jenkins-Pipeline.git'
        }
        dir('Webstore') {
           git credentialsId: 'Github-prabinovich', url: 'https://github.com/prabinovich/WebStore.git'
        }
    }
    
    /*
    stage ('CAST-Packaging') {
        echo '-- Packaging and Delivery of Source Code --'
        bat '%WORKSPACE%\\CAST-Scripts\\CLI-Scripts\\CMS_AutomateDelivery.bat "profile=sandbox838" "app=Webstore" "fromVersion=Baseline" "version=version %BUILD_NUMBER%"'
    }
    
    stage ('CAST-Analysis') {
        echo '-- Analyze Application --'
        bat '%WORKSPACE%\\CAST-Scripts\\CLI-Scripts\\CMS_Analyze.bat "profile=sandbox838" "app=Webstore"'
    }
    
    stage ('CAST-Snapshot') {
        echo '-- Generate Snapshot --'
        bat '%WORKSPACE%\\CAST-Scripts\\CLI-Scripts\\CMS_GenerateSnapshot.bat "profile=sandbox838" "app=Webstore" "version=version %BUILD_NUMBER%"'
    }
    */
    
    stage('CAST-Publish Results'){
        echo "-- Consolidate Snapshot --"        
        bat "\"C:\\Program Files\\CAST\\8.3\\AAD\\CLI\\AadConsolidation.exe\" -url jdbc:postgresql://localhost:2282/postgres -schema yellowdog_measure -password CastAIP -remote_url jdbc:postgresql://localhost:2282/postgres -remote_schema yellowdog_central -remote_password CastAIP"
        bat "curl -u admin:admin -H \"Accept: application/json\" http://localhost:8080/CAST-Health-Engineering-838/rest/server/reload"
    }

}
